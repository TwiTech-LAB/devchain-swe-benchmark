{
  "instance_id": "pytest-dev__pytest-6197",
  "status": "completed",
  "patch": "diff --git a/src/_pytest/python.py b/src/_pytest/python.py\nindex 306e5f217..6d7c5b80c 100644\n--- a/src/_pytest/python.py\n+++ b/src/_pytest/python.py\n@@ -639,13 +639,14 @@ class Package(Module):\n         return path in self.session._initialpaths\n \n     def collect(self):\n-        self._mount_obj_if_needed()\n         this_path = self.fspath.dirpath()\n         init_module = this_path.join(\"__init__.py\")\n+        # Collect all items first, then mount if needed\n+        collected = []\n         if init_module.check(file=1) and path_matches_patterns(\n             init_module, self.config.getini(\"python_files\")\n         ):\n-            yield Module(init_module, self)\n+            collected.append(Module(init_module, self))\n         pkg_prefixes = set()\n         for path in this_path.visit(rec=self._recurse, bf=True, sort=True):\n             # We will visit our own __init__.py file, in which case we skip it.\n@@ -662,13 +663,20 @@ class Package(Module):\n                 continue\n \n             if is_file:\n-                yield from self._collectfile(path)\n+                collected.extend(self._collectfile(path))\n             elif not path.isdir():\n                 # Broken symlink or invalid/missing file.\n                 continue\n             elif path.join(\"__init__.py\").check(file=1):\n                 pkg_prefixes.add(path)\n \n+        # Only import the __init__.py if we actually have test items to collect\n+        # This prevents importing __init__.py files from non-test packages\n+        if collected:\n+            self._mount_obj_if_needed()\n+\n+        yield from collected\n+\n \n def _call_with_optional_argument(func, arg):\n     \"\"\"Call the given function with the given argument if func accepts one argument, otherwise\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-01-17T01:35:07.156814",
  "end_time": "2026-01-17T01:44:47.017396",
  "duration_seconds": 579.860582,
  "error_message": null,
  "workspace_path": "./workspaces/pytest-dev__pytest-6197",
  "epic_comments": [
    {
      "epic_id": "ae303f06-35cc-47ad-921e-d1d236de4592",
      "epic_title": "Fix: pytest-dev__pytest-6197",
      "comment_id": "f4d6ae01-ab73-4698-962b-4c159ba6f939",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nFixed the regression where pytest 5.2.3 tries to import any `__init__.py` file under the current directory.\n\n**Root Cause**: In commit #5831, `self._mount_obj_if_needed()` was added at the start of `Package.collect()` to fix bug #5830 (pytestmark in package `__init__.py` not being applied). However, this caused ALL `__init__.py` files to be imported, even those in non-test directories.\n\n**Solution**: Modified `Package.collect()` to only call `_mount_obj_if_needed()` AFTER determining there are actual test items to collect. This approach:\n1. Fixes the regression (random `__init__.py` files are no longer imported)\n2. Preserves the #5830 fix (pytestmark in `__init__.py` still works for packages that have tests)\n\n## Files Modified\n\n- `src/_pytest/python.py`: Modified `Package.collect()` method to collect items first into a list, then only call `_mount_obj_if_needed()` if there are items, and finally yield them.\n\n## Test Results\n\n- **Test file:** `testing/test_collection.py`\n- **Baseline (before fix):** 71 passed, 1 xfailed\n- **After fix:** 71 passed, 1 xfailed\n- **Regression check:** No new failures\n\n- **Test file:** `testing/test_skipping.py`\n- **Baseline (before fix):** 76 passed\n- **After fix:** 76 passed (including `test_skip_package` which verifies #5830 still works)\n\n- **Test file:** `testing/python/` (excluding metafunc.py)\n- **Baseline (before fix):** 7 failed, 358 passed, 17 skipped, 1 xfailed\n- **After fix:** 7 failed, 358 passed, 17 skipped, 1 xfailed (same pre-existing failures)\n\n## Additional Verification\n\nReproduced the exact issue from the problem statement:\n```\nmkdir foobar\necho 'assert False' > foobar/__init__.py\necho 'def test_foo(): pass' > test_foo.py\npytest -v\n```\n\n**Before fix:** Would fail with `AssertionError` when trying to import `foobar/__init__.py`\n**After fix:** Runs successfully, only collecting `test_foo.py`\n\n## Concerns\n\nNone. The fix is minimal and targeted - it only changes the timing of when `_mount_obj_if_needed()` is called, ensuring it's only called when necessary.",
      "created_at": "2026-01-17T00:44:33.420Z"
    }
  ]
}