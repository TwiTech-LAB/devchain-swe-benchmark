{
  "instance_id": "django__django-14053",
  "status": "completed",
  "patch": "diff --git a/django/contrib/staticfiles/storage.py b/django/contrib/staticfiles/storage.py\nindex 494890cc23..a6ef522277 100644\n--- a/django/contrib/staticfiles/storage.py\n+++ b/django/contrib/staticfiles/storage.py\n@@ -226,18 +226,29 @@ class HashedFilesMixin:\n             path for path in paths\n             if matches_patterns(path, self._patterns)\n         ]\n+\n+        # Track the final processed state for each file to avoid yielding\n+        # the same file multiple times.\n+        processed_adjustable_paths = {}\n+\n         # Do a single pass first. Post-process all files once, then repeat for\n         # adjustable files.\n         for name, hashed_name, processed, _ in self._post_process(paths, adjustable_paths, hashed_files):\n-            yield name, hashed_name, processed\n+            if isinstance(processed, Exception):\n+                yield name, hashed_name, processed\n+            else:\n+                processed_adjustable_paths[name] = (hashed_name, processed)\n \n         paths = {path: paths[path] for path in adjustable_paths}\n \n         for i in range(self.max_post_process_passes):\n             substitutions = False\n             for name, hashed_name, processed, subst in self._post_process(paths, adjustable_paths, hashed_files):\n-                yield name, hashed_name, processed\n-                substitutions = substitutions or subst\n+                if isinstance(processed, Exception):\n+                    yield name, hashed_name, processed\n+                else:\n+                    processed_adjustable_paths[name] = (hashed_name, processed)\n+                    substitutions = substitutions or subst\n \n             if not substitutions:\n                 break\n@@ -245,6 +256,10 @@ class HashedFilesMixin:\n         if substitutions:\n             yield 'All', None, RuntimeError('Max post-process passes exceeded.')\n \n+        # Yield the final processed state of each file only once.\n+        for name, (hashed_name, processed) in processed_adjustable_paths.items():\n+            yield name, hashed_name, processed\n+\n         # Store the processed paths\n         self.hashed_files.update(hashed_files)\n \n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-01-17T11:15:18.961076",
  "end_time": "2026-01-17T11:25:00.144666",
  "duration_seconds": 581.18359,
  "error_message": null,
  "workspace_path": "./workspaces/django__django-14053",
  "epic_comments": [
    {
      "epic_id": "31166bf2-315d-404d-8371-945875d63a06",
      "epic_title": "Fix: django__django-14053",
      "comment_id": "7442364e-eec4-4f6f-8d81-da7ef81c9bbb",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\nFixed `HashedFilesMixin.post_process()` to only yield each file once with its final processed state, instead of yielding the same file multiple times during each processing pass.\n\nThe issue was that the original implementation yielded files immediately during each pass (initial pass + up to 5 subsequent passes for adjustable files). This caused:\n1. Incorrect statistics in collectstatic output\n2. Subclasses like WhiteNoise performing duplicate work (e.g., compressing the same file multiple times)\n3. S3 backends potentially uploading multiple times\n\n## Files Modified\n- `django/contrib/staticfiles/storage.py`: Modified `post_process()` method in `HashedFilesMixin` class (lines 203-264)\n\n## Technical Approach\n1. Added a `processed_adjustable_paths` dictionary to track the final state of each file\n2. During processing passes, exceptions are still yielded immediately (preserving error reporting behavior)\n3. Non-exception results are stored in the dictionary, overwriting previous entries for the same file\n4. At the end, all files are yielded once from the dictionary with their final processed state\n\n## Test Results\n- **Test file:** `/testbed/tests/staticfiles_tests/test_storage.py`\n- **Baseline (before fix):** 32 tests passed, 0 failed, 0 errors\n- **After fix:** 32 tests passed, 0 failed, 0 errors\n- **Full staticfiles suite:** 152 tests passed, 0 failed, 0 errors\n- **Regression check:** No new failures introduced\n\n## Additional Verification\nVerified with a custom test script that:\n- Each file is now yielded at most once with a success result\n- Files that previously showed multiple yields (e.g., `admin/css/base.css` yielded 3 times in the original) are now yielded only once\n\n## Concerns\n- Error yields during the first pass (for temporary \"file not found\" when referenced files haven't been processed yet) are still yielded separately from the final success result. This is the expected behavior as these errors happen in a single pass when a file references another file that hasn't been hashed yet.",
      "created_at": "2026-01-17T10:24:47.712Z"
    }
  ]
}