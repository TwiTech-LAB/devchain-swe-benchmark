{
  "instance_id": "django__django-13569",
  "status": "completed",
  "patch": "diff --git a/django/db/models/functions/math.py b/django/db/models/functions/math.py\nindex 304e112225..15915f4b7c 100644\n--- a/django/db/models/functions/math.py\n+++ b/django/db/models/functions/math.py\n@@ -154,6 +154,9 @@ class Random(NumericOutputFieldMixin, Func):\n     def as_sqlite(self, compiler, connection, **extra_context):\n         return super().as_sql(compiler, connection, function='RAND', **extra_context)\n \n+    def get_group_by_cols(self, alias=None):\n+        return []\n+\n \n class Round(Transform):\n     function = 'ROUND'\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-01-16T12:52:04.625174",
  "end_time": "2026-01-16T12:58:28.185051",
  "duration_seconds": 383.559877,
  "error_message": null,
  "workspace_path": "./workspaces/django__django-13569",
  "epic_comments": [
    {
      "epic_id": "b0acb237-fb03-46a5-ba34-bcb1100ef05c",
      "epic_title": "Fix: django__django-13569",
      "comment_id": "840df786-c564-4918-b644-0739b3727974",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\nThe `order_by('?')` was breaking queryset aggregation because `RANDOM()` was being included in the `GROUP BY` clause. The issue was in the `Random` class which inherited the default `get_group_by_cols()` behavior from `Expression`, which returns `[self]` for non-aggregate expressions.\n\nThe fix adds an override of `get_group_by_cols()` in the `Random` class to return an empty list `[]`. This is correct because `RANDOM()` has no column references (arity=0) and should never be part of a `GROUP BY` clause - it's a stateless function that doesn't reference any table columns.\n\n## Files Modified\n- `django/db/models/functions/math.py`: Added `get_group_by_cols()` method to the `Random` class that returns `[]`\n\n## Test Results\n- **Test file:** tests/ordering/tests.py, tests/aggregation/tests.py, tests/db_functions/math/*\n- **Baseline (before fix):** 26 passed (ordering), 81 passed (aggregation), 103 passed (db_functions.math)\n- **After fix:** 26 passed (ordering), 81 passed (aggregation), 103 passed (db_functions.math)\n- **Regression check:** No new failures introduced\n- **Additional tests:** expressions (154 passed), queries (398 passed)\n\n## Additional Verification\nThe fix is minimal and targeted. By overriding `get_group_by_cols()` to return `[]`, the `Random` expression will no longer be included in the `GROUP BY` clause generated by `compiler.get_group_by()`.\n\n## Concerns\nNone. This is a straightforward fix that follows the same pattern used by other expressions that shouldn't be in GROUP BY (like `Value`, `Window`, `WindowFrame` which also return `[]` from `get_group_by_cols()`).",
      "created_at": "2026-01-16T11:55:13.527Z"
    },
    {
      "epic_id": "b0acb237-fb03-46a5-ba34-bcb1100ef05c",
      "epic_title": "Fix: django__django-13569",
      "comment_id": "b9a1efad-f5f1-441d-bcf5-2e38fd4950de",
      "author_name": "Code Reviewer",
      "content": "Code review PASSED.\n\n- Change is minimal and correctly targets the root cause: `Random()` no longer contributes itself to `GROUP BY` via `get_group_by_cols()`, so `order_by('?')` won\u2019t force `GROUP BY RANDOM()` and break aggregations.\n- Verified `git diff` touches only `django/db/models/functions/math.py` (no tests/build configs modified).\n- Brainstormer provided baseline vs after results and ran real Django test modules (ordering/aggregation/db_functions.math) with no regressions reported.",
      "created_at": "2026-01-16T11:58:18.577Z"
    }
  ]
}