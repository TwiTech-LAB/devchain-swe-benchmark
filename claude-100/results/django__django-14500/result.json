{
  "instance_id": "django__django-14500",
  "status": "completed",
  "patch": "diff --git a/django/db/migrations/executor.py b/django/db/migrations/executor.py\nindex 57042a8690..2a90dd9481 100644\n--- a/django/db/migrations/executor.py\n+++ b/django/db/migrations/executor.py\n@@ -263,7 +263,8 @@ class MigrationExecutor:\n \n     def check_replacements(self):\n         \"\"\"\n-        Mark replacement migrations applied if their replaced set all are.\n+        Mark replacement migrations applied if their replaced set all are,\n+        or unapplied if any of the replaced migrations are not applied.\n \n         Do this unconditionally on every migrate, rather than just when\n         migrations are applied or unapplied, to correctly handle the case\n@@ -277,6 +278,8 @@ class MigrationExecutor:\n             all_applied = all(m in applied for m in migration.replaces)\n             if all_applied and key not in applied:\n                 self.recorder.record_applied(*key)\n+            elif not all_applied and key in applied:\n+                self.recorder.record_unapplied(*key)\n \n     def detect_soft_applied(self, project_state, migration):\n         \"\"\"\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-01-16T20:12:46.677993",
  "end_time": "2026-01-16T20:15:28.851816",
  "duration_seconds": 162.173823,
  "error_message": null,
  "workspace_path": "./workspaces/django__django-14500",
  "epic_comments": [
    {
      "epic_id": "f1668a1e-83fa-4a6a-9ff4-6f5a2ed24652",
      "epic_title": "Fix: django__django-14500",
      "comment_id": "46823f2b-8fbb-4ea1-aa51-2488d7ac1452",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\nWhen unapplying a squashed migration, the squashed migration itself was not being marked as unapplied in the database. The `check_replacements` method only handled marking squashed migrations as applied when all replaced migrations were applied, but it didn't handle the reverse case.\n\nThe fix adds an `elif` clause to also mark the squashed migration as unapplied when:\n1. Not all replaced migrations are applied (`not all_applied`)\n2. The squashed migration is currently marked as applied (`key in applied`)\n\n## Files Modified\n- `django/db/migrations/executor.py`: Added logic to `check_replacements()` to mark squashed migrations as unapplied when their replaced migrations are unapplied\n\n## Test Results\n- **Test file:** `tests/migrations/test_executor.py`\n- **Baseline (before fix):** 21 passed, 0 failed, 0 errors\n- **After fix:** 21 passed, 0 failed, 0 errors\n- **Regression check:** No new failures introduced\n\nAdditional test suite (`tests/migrations/test_commands.py`):\n- **After fix:** 100 passed, 0 failed, 0 errors\n\n## Additional Verification\n- Verified the fix is applied by inspecting the source code\n- The change correctly maintains symmetry: squashed migrations are marked applied when all replaced are applied, AND marked unapplied when any replaced is not applied\n\n## Concerns\n- None. The fix is minimal and follows the existing pattern in the method.",
      "created_at": "2026-01-16T19:15:16.599Z"
    }
  ]
}