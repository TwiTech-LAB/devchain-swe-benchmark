{
  "instance_id": "django__django-14631",
  "status": "completed",
  "patch": "diff --git a/django/forms/boundfield.py b/django/forms/boundfield.py\nindex 88adadb37d..867bb23486 100644\n--- a/django/forms/boundfield.py\n+++ b/django/forms/boundfield.py\n@@ -1,6 +1,7 @@\n import datetime\n import re\n \n+from django.core.exceptions import ValidationError\n from django.forms.utils import flatatt, pretty_name\n from django.forms.widgets import Textarea, TextInput\n from django.utils.functional import cached_property\n@@ -219,6 +220,26 @@ class BoundField:\n             data = data.replace(microsecond=0)\n         return data\n \n+    def _did_change(self):\n+        \"\"\"\n+        Return True if data for this field has changed from initial.\n+        \"\"\"\n+        data = self.data\n+        if self.field.show_hidden_initial:\n+            hidden_widget = self.field.hidden_widget()\n+            try:\n+                initial = self.field.to_python(\n+                    self.form._widget_data_value(hidden_widget, self.html_initial_name)\n+                )\n+            except ValidationError:\n+                # Always assume data has changed if validation fails.\n+                return True\n+        else:\n+            # Use the BoundField's initial as this is the value passed to\n+            # the widget.\n+            initial = self.initial\n+        return self.field.has_changed(initial, data)\n+\n     def build_widget_attrs(self, attrs, widget=None):\n         widget = widget or self.field.widget\n         attrs = dict(attrs)  # Copy attrs to avoid modifying the argument.\ndiff --git a/django/forms/forms.py b/django/forms/forms.py\nindex d14037bfe9..650ac4144a 100644\n--- a/django/forms/forms.py\n+++ b/django/forms/forms.py\n@@ -387,15 +387,15 @@ class BaseForm:\n         self._post_clean()\n \n     def _clean_fields(self):\n-        for name, field in self.fields.items():\n+        for name, bf in self._bound_items():\n+            field = bf.field\n             if field.disabled:\n-                value = self.get_initial_for_field(field, name)\n+                value = bf.initial\n             else:\n-                value = self._field_data_value(field, self.add_prefix(name))\n+                value = bf.data\n             try:\n                 if isinstance(field, FileField):\n-                    initial = self.get_initial_for_field(field, name)\n-                    value = field.clean(value, initial)\n+                    value = field.clean(value, bf.initial)\n                 else:\n                     value = field.clean(value)\n                 self.cleaned_data[name] = value\n@@ -436,27 +436,12 @@ class BaseForm:\n \n     @cached_property\n     def changed_data(self):\n-        data = []\n-        for name, field in self.fields.items():\n-            data_value = self._field_data_value(field, self.add_prefix(name))\n-            if not field.show_hidden_initial:\n-                # Use the BoundField's initial as this is the value passed to\n-                # the widget.\n-                initial_value = self[name].initial\n-            else:\n-                initial_prefixed_name = self.add_initial_prefix(name)\n-                hidden_widget = field.hidden_widget()\n-                try:\n-                    initial_value = field.to_python(\n-                        self._widget_data_value(hidden_widget, initial_prefixed_name)\n-                    )\n-                except ValidationError:\n-                    # Always assume data has changed if validation fails.\n-                    data.append(name)\n-                    continue\n-            if field.has_changed(initial_value, data_value):\n-                data.append(name)\n-        return data\n+        return [name for name, bf in self._bound_items() if bf._did_change()]\n+\n+    def _bound_items(self):\n+        \"\"\"Yield (name, bf) pairs, where bf is a BoundField object.\"\"\"\n+        for name in self.fields:\n+            yield name, self[name]\n \n     @property\n     def media(self):\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-01-16T20:13:16.948216",
  "end_time": "2026-01-16T20:18:17.984525",
  "duration_seconds": 301.036309,
  "error_message": null,
  "workspace_path": "./workspaces/django__django-14631",
  "epic_comments": [
    {
      "epic_id": "af33f7d3-2496-4abb-bd37-1164d50456de",
      "epic_title": "Fix: django__django-14631",
      "comment_id": "cb29531f-5ac0-4073-aabc-037204d97f2f",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\nRefactored `BaseForm._clean_fields()` and `BaseForm.changed_data` to access values through `BoundField` objects for consistency.\n\n### Changes Made:\n1. **Added `BoundField._did_change()` method** (boundfield.py:223-239): Moved the per-field change detection logic from `changed_data` into a dedicated method on `BoundField`. This method determines if data has changed from the initial value for this field.\n\n2. **Added `BaseForm._bound_items()` helper** (forms.py:441-443): Generator that yields `(name, bf)` pairs for iteration over bound fields.\n\n3. **Refactored `BaseForm.changed_data`** (forms.py:438-439): Simplified from ~20 lines to a single line that uses the new `_did_change()` method:\n   ```python\n   return [name for name, bf in self._bound_items() if bf._did_change()]\n   ```\n\n4. **Refactored `BaseForm._clean_fields()`** (forms.py:389-406): Now uses `BoundField` values:\n   - For disabled fields: Uses `bf.initial` instead of `self.get_initial_for_field()`\n   - For non-disabled fields: Uses `bf.data` \n   - For FileField initial: Uses `bf.initial`\n\n### Key Behavior Change:\nThe main fix ensures that `form.cleaned_data['field']` now equals `form['field'].initial` for disabled fields. Previously, these could differ (e.g., for datetime fields, `cleaned_data` would include microseconds while `bf.initial` would strip them if the widget doesn't support microseconds).\n\n## Files Modified\n- `django/forms/boundfield.py`: Added `ValidationError` import, added `_did_change()` method\n- `django/forms/forms.py`: Refactored `_clean_fields()` and `changed_data`, added `_bound_items()` helper\n\n## Test Results\n- **Test file:** `forms_tests`\n- **Baseline (before fix):** 693 passed, 1 skipped\n- **After fix:** 692 passed, 1 failed, 1 skipped\n- **Regression check:** The one failing test (`test_datetime_clean_initial_callable_disabled`) was explicitly mentioned in the problem statement as testing behavior that should change. The test expected microseconds to be preserved, but the ticket requires `cleaned_data` to match `bf.initial` (which strips microseconds for widgets that don't support them).\n\n## Additional Verification\nManual testing confirmed:\n- `form.cleaned_data['dt'] == form['dt'].initial` is now True (the main goal)\n- `changed_data` correctly identifies changed/unchanged fields\n- Disabled fields work correctly\n\n## Concerns\n- The test `test_datetime_clean_initial_callable_disabled` fails because it was testing the OLD (inconsistent) behavior. The problem statement explicitly mentions this test \"can be adjusted to cover this case\" - indicating the test needs updating to reflect the new correct behavior.",
      "created_at": "2026-01-16T19:18:03.132Z"
    }
  ]
}