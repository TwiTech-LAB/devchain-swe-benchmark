{
  "instance_id": "django__django-14725",
  "status": "completed",
  "patch": "diff --git a/django/forms/formsets.py b/django/forms/formsets.py\nindex 75b0646512..92832ed886 100644\n--- a/django/forms/formsets.py\n+++ b/django/forms/formsets.py\n@@ -478,7 +478,7 @@ class BaseFormSet(RenderableFormMixin):\n def formset_factory(form, formset=BaseFormSet, extra=1, can_order=False,\n                     can_delete=False, max_num=None, validate_max=False,\n                     min_num=None, validate_min=False, absolute_max=None,\n-                    can_delete_extra=True, renderer=None):\n+                    can_delete_extra=True, can_add=True, renderer=None):\n     \"\"\"Return a FormSet for the given form class.\"\"\"\n     if min_num is None:\n         min_num = DEFAULT_MIN_NUM\n@@ -499,6 +499,7 @@ def formset_factory(form, formset=BaseFormSet, extra=1, can_order=False,\n         'can_order': can_order,\n         'can_delete': can_delete,\n         'can_delete_extra': can_delete_extra,\n+        'can_add': can_add,\n         'min_num': min_num,\n         'max_num': max_num,\n         'absolute_max': absolute_max,\ndiff --git a/django/forms/models.py b/django/forms/models.py\nindex 7effb202e3..6a277bd772 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -813,6 +813,8 @@ class BaseModelFormSet(BaseFormSet):\n \n     def save_new_objects(self, commit=True):\n         self.new_objects = []\n+        if not self.can_add:\n+            return self.new_objects\n         for form in self.extra_forms:\n             if not form.has_changed():\n                 continue\n@@ -875,7 +877,8 @@ def modelformset_factory(model, form=ModelForm, formfield_callback=None,\n                          widgets=None, validate_max=False, localized_fields=None,\n                          labels=None, help_texts=None, error_messages=None,\n                          min_num=None, validate_min=False, field_classes=None,\n-                         absolute_max=None, can_delete_extra=True, renderer=None):\n+                         absolute_max=None, can_delete_extra=True, can_add=True,\n+                         renderer=None):\n     \"\"\"Return a FormSet class for the given Django model class.\"\"\"\n     meta = getattr(form, 'Meta', None)\n     if (getattr(meta, 'fields', fields) is None and\n@@ -894,7 +897,7 @@ def modelformset_factory(model, form=ModelForm, formfield_callback=None,\n                               can_order=can_order, can_delete=can_delete,\n                               validate_min=validate_min, validate_max=validate_max,\n                               absolute_max=absolute_max, can_delete_extra=can_delete_extra,\n-                              renderer=renderer)\n+                              can_add=can_add, renderer=renderer)\n     FormSet.model = model\n     return FormSet\n \n@@ -1076,7 +1079,8 @@ def inlineformset_factory(parent_model, model, form=ModelForm,\n                           widgets=None, validate_max=False, localized_fields=None,\n                           labels=None, help_texts=None, error_messages=None,\n                           min_num=None, validate_min=False, field_classes=None,\n-                          absolute_max=None, can_delete_extra=True, renderer=None):\n+                          absolute_max=None, can_delete_extra=True, can_add=True,\n+                          renderer=None):\n     \"\"\"\n     Return an ``InlineFormSet`` for the given kwargs.\n \n@@ -1108,6 +1112,7 @@ def inlineformset_factory(parent_model, model, form=ModelForm,\n         'field_classes': field_classes,\n         'absolute_max': absolute_max,\n         'can_delete_extra': can_delete_extra,\n+        'can_add': can_add,\n         'renderer': renderer,\n     }\n     FormSet = modelformset_factory(model, **kwargs)\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-02-03T11:27:58.446060",
  "end_time": "2026-02-03T11:37:11.356195",
  "duration_seconds": 552.910135,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "5b5e3c7a-9f59-4769-8342-ca98ec9a3f02",
      "epic_title": "Fix: django__django-14725",
      "comment_id": "100fbce2-ec4b-4aab-805b-782cee7c1a12",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nAdded a `can_add` parameter to model formsets that allows disallowing new object creation. When `can_add=False`, the formset will only update existing objects and ignore any extra forms that would normally create new objects.\n\n## Files Modified\n- `django/forms/formsets.py`: Added `can_add=True` parameter to `formset_factory` and added it to the formset class attributes\n- `django/forms/models.py`: \n  - Added `can_add=True` parameter to `modelformset_factory` and `inlineformset_factory`\n  - Modified `BaseModelFormSet.save_new_objects` to check `self.can_add` and return early if `False`\n\n## Test Results\n- **Baseline (before fix):** 145 formsets tests passed, 73 skipped\n- **After fix:** 145 formsets tests passed, 73 skipped\n- **Full forms test suite:** 890 tests passed, 204 skipped\n- **Admin inlines tests:** 81 tests passed, 12 skipped\n- **Admin views tests:** All passed\n\n## Additional Verification\nCreated a test demonstrating that:\n1. With `can_add=True` (default), new objects are created as expected\n2. With `can_add=False`, even if extra forms are submitted via POST data (simulating JavaScript manipulation), new objects are NOT created - only existing objects are updated\n\n## Usage Example\n```python\nfrom django.forms.models import modelformset_factory\n\n# Create an \"edit only\" formset - no new objects can be created\nAuthorFormSet = modelformset_factory(Author, fields=['name'], can_add=False)\n```\n\n## Edge Cases Considered\n- Default value is `True` to maintain backward compatibility\n- Works with both regular modelformsets and inline formsets\n- The `extra` parameter still works for display purposes, but forms won't create new objects\n- Existing objects can still be updated normally\n\n## Concerns\n- None identified. The implementation is minimal and follows the existing patterns for `can_delete` and `can_order`.",
      "created_at": "2026-02-03T10:35:33.588Z"
    },
    {
      "epic_id": "5b5e3c7a-9f59-4769-8342-ca98ec9a3f02",
      "epic_title": "Fix: django__django-14725",
      "comment_id": "5ff8fa4a-5d2e-4161-bedb-43c2be6b190e",
      "author_name": "Code Reviewer",
      "content": "## Code Review PASSED\n\n**Checklist:**\n- [x] No test files modified \u2014 only `django/forms/formsets.py` and `django/forms/models.py`\n- [x] No unrelated files modified \u2014 both files are directly relevant\n- [x] Fix logically addresses the problem \u2014 adds `can_add` parameter that prevents new object creation when set to `False`\n- [x] No obvious crash bugs \u2014 simple early return in `save_new_objects()` when `can_add` is `False`\n- [x] Changes are minimal and focused \u2014 only 10 insertions, 4 deletions across 2 files\n\n**Review Notes:**\n- The implementation correctly follows Django's existing pattern for `can_delete` and `can_order` \u2014 attribute set via factory function, consumed in formset methods.\n- `can_add=True` default preserves full backward compatibility.\n- The guard in `BaseModelFormSet.save_new_objects()` is the right place to block new object creation \u2014 it prevents saving regardless of whether extra forms were added via `extra` parameter or injected via JavaScript/POST data, which is exactly what the problem statement requested.\n- Properly threaded through all three factory functions: `formset_factory`, `modelformset_factory`, and `inlineformset_factory`.\n- All existing tests pass with no regressions (145 formset tests, 890 full form tests, 81 admin inline tests).",
      "created_at": "2026-02-03T10:36:57.963Z"
    }
  ]
}