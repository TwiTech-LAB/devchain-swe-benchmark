{
  "instance_id": "django__django-13195",
  "status": "completed",
  "patch": "diff --git a/django/contrib/messages/storage/cookie.py b/django/contrib/messages/storage/cookie.py\nindex 78256ca3b2..b51e292aa0 100644\n--- a/django/contrib/messages/storage/cookie.py\n+++ b/django/contrib/messages/storage/cookie.py\n@@ -92,7 +92,11 @@ class CookieStorage(BaseStorage):\n                 samesite=settings.SESSION_COOKIE_SAMESITE,\n             )\n         else:\n-            response.delete_cookie(self.cookie_name, domain=settings.SESSION_COOKIE_DOMAIN)\n+            response.delete_cookie(\n+                self.cookie_name,\n+                domain=settings.SESSION_COOKIE_DOMAIN,\n+                samesite=settings.SESSION_COOKIE_SAMESITE,\n+            )\n \n     def _store(self, messages, response, remove_oldest=True, *args, **kwargs):\n         \"\"\"\ndiff --git a/django/contrib/sessions/middleware.py b/django/contrib/sessions/middleware.py\nindex 63013eef7a..95ad30ce7f 100644\n--- a/django/contrib/sessions/middleware.py\n+++ b/django/contrib/sessions/middleware.py\n@@ -42,6 +42,7 @@ class SessionMiddleware(MiddlewareMixin):\n                 settings.SESSION_COOKIE_NAME,\n                 path=settings.SESSION_COOKIE_PATH,\n                 domain=settings.SESSION_COOKIE_DOMAIN,\n+                samesite=settings.SESSION_COOKIE_SAMESITE,\n             )\n             patch_vary_headers(response, ('Cookie',))\n         else:\ndiff --git a/django/http/response.py b/django/http/response.py\nindex e00bcacefb..b9ad30c5ea 100644\n--- a/django/http/response.py\n+++ b/django/http/response.py\n@@ -210,13 +210,13 @@ class HttpResponseBase:\n         value = signing.get_cookie_signer(salt=key + salt).sign(value)\n         return self.set_cookie(key, value, **kwargs)\n \n-    def delete_cookie(self, key, path='/', domain=None):\n+    def delete_cookie(self, key, path='/', domain=None, samesite=None):\n         # Most browsers ignore the Set-Cookie header if the cookie name starts\n         # with __Host- or __Secure- and the cookie doesn't use the secure flag.\n         secure = key.startswith(('__Secure-', '__Host-'))\n         self.set_cookie(\n             key, max_age=0, path=path, domain=domain, secure=secure,\n-            expires='Thu, 01 Jan 1970 00:00:00 GMT',\n+            expires='Thu, 01 Jan 1970 00:00:00 GMT', samesite=samesite,\n         )\n \n     # Common methods used by subclasses\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-02-03T12:08:27.720200",
  "end_time": "2026-02-03T12:12:59.425011",
  "duration_seconds": 271.704811,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "d8b3f786-d1dc-480c-82b2-6d25f755bb85",
      "epic_title": "Fix: django__django-13195",
      "comment_id": "0f9a5582-c42f-4d07-ac15-8a03a0efe773",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nFixed `HttpResponse.delete_cookie()` to preserve the `samesite` attribute when deleting cookies. Previously, when a cookie was set with `SameSite=Lax` (or any other value), the deletion cookie didn't include the `SameSite` attribute, causing browser warnings.\n\n## Root Cause\n\nThe `delete_cookie()` method in `HttpResponseBase` didn't accept a `samesite` parameter and therefore didn't pass it to `set_cookie()`. This caused the deletion cookie to be set without the `SameSite` attribute, even when the original cookie was set with it.\n\n## Files Modified\n\n1. **django/http/response.py**: Added `samesite` parameter to `delete_cookie()` method and passed it through to `set_cookie()`\n2. **django/contrib/messages/storage/cookie.py**: Updated `delete_cookie()` call to pass `samesite=settings.SESSION_COOKIE_SAMESITE`\n3. **django/contrib/sessions/middleware.py**: Updated `delete_cookie()` call to pass `samesite=settings.SESSION_COOKIE_SAMESITE`\n\n## Test Results\n\nAll manual verification tests passed:\n- delete_cookie with samesite='Lax' \u2192 Sets `SameSite=Lax`\n- delete_cookie with samesite='Strict' \u2192 Sets `SameSite=Strict`\n- delete_cookie with samesite='None' \u2192 Sets `SameSite=None`\n- delete_cookie without samesite \u2192 Backward compatible (no SameSite attribute)\n- delete_cookie with __Secure- prefix + samesite \u2192 Both secure and samesite preserved\n\n## Edge Cases Considered\n\n- Empty inputs: None value for samesite is handled correctly (no attribute set)\n- Different input types: All valid samesite values ('Lax', 'None', 'Strict') work correctly\n- Backward compatibility: Existing code that doesn't pass samesite continues to work\n- __Secure- and __Host- prefixes: The secure flag logic is preserved\n\n## Concerns\n\nNone. The fix is minimal, focused, and maintains backward compatibility.",
      "created_at": "2026-02-03T11:11:53.940Z"
    },
    {
      "epic_id": "d8b3f786-d1dc-480c-82b2-6d25f755bb85",
      "epic_title": "Fix: django__django-13195",
      "comment_id": "988eed35-c00c-4d09-b5aa-bc2b87f7d4b3",
      "author_name": "Code Reviewer",
      "content": "## Code Review PASSED\n\n**Changes reviewed:**\n- `django/http/response.py` \u2014 Added `samesite=None` parameter to `delete_cookie()` and passed it through to `set_cookie()`\n- `django/contrib/messages/storage/cookie.py` \u2014 Updated `delete_cookie()` call to pass `samesite=settings.SESSION_COOKIE_SAMESITE`\n- `django/contrib/sessions/middleware.py` \u2014 Updated `delete_cookie()` call to pass `samesite=settings.SESSION_COOKIE_SAMESITE`\n\n**Checklist:**\n- [x] No test files modified\n- [x] No unrelated files modified\n- [x] Fix logically addresses the problem (deletion cookies now preserve `SameSite` attribute)\n- [x] No obvious crash bugs (default `None` preserves backward compatibility; `set_cookie` already supports `samesite`)\n- [x] Changes are minimal and focused\n- [x] Callers are consistent \u2014 messages `cookie.py` already uses `SESSION_COOKIE_SAMESITE` in its `set_cookie` call, so the `delete_cookie` call now matches\n\nThe fix directly addresses the reported issue: `delete_cookie()` now supports the `samesite` attribute, preventing browser warnings about missing `SameSite` on deletion cookies.",
      "created_at": "2026-02-03T11:12:54.209Z"
    }
  ]
}