{
  "instance_id": "sphinx-doc__sphinx-7440",
  "status": "completed",
  "patch": "diff --git a/sphinx/domains/std.py b/sphinx/domains/std.py\nindex d820cfe5c..ff1cec613 100644\n--- a/sphinx/domains/std.py\n+++ b/sphinx/domains/std.py\n@@ -305,7 +305,7 @@ def make_glossary_term(env: \"BuildEnvironment\", textnodes: Iterable[Node], index\n         term['ids'].append(node_id)\n \n     std = cast(StandardDomain, env.get_domain('std'))\n-    std.note_object('term', termtext.lower(), node_id, location=term)\n+    std.note_object('term', termtext, node_id, location=term)\n \n     # add an index entry too\n     indexnode = addnodes.index()\n@@ -928,8 +928,20 @@ class StandardDomain(Domain):\n                           node: pending_xref, contnode: Element) -> Element:\n         objtypes = self.objtypes_for_role(typ) or []\n         for objtype in objtypes:\n-            if (objtype, target) in self.objects:\n-                docname, labelid = self.objects[objtype, target]\n+            if objtype == 'term':\n+                # For terms, lookup case-insensitively\n+                ltarget = target.lower()\n+                for (type, name), (docname, labelid) in self.objects.items():\n+                    if type == objtype and name.lower() == ltarget:\n+                        break\n+                else:\n+                    docname, labelid = '', ''\n+            else:\n+                if (objtype, target) in self.objects:\n+                    docname, labelid = self.objects[objtype, target]\n+                else:\n+                    docname, labelid = '', ''\n+            if docname:\n                 break\n         else:\n             docname, labelid = '', ''\n@@ -951,14 +963,21 @@ class StandardDomain(Domain):\n                 results.append(('std:' + role, res))\n         # all others\n         for objtype in self.object_types:\n-            key = (objtype, target)\n             if objtype == 'term':\n-                key = (objtype, ltarget)\n-            if key in self.objects:\n-                docname, labelid = self.objects[key]\n-                results.append(('std:' + self.role_for_objtype(objtype),\n-                                make_refnode(builder, fromdocname, docname,\n-                                             labelid, contnode)))\n+                # For terms, lookup case-insensitively\n+                for (type, name), (docname, labelid) in self.objects.items():\n+                    if type == objtype and name.lower() == ltarget:\n+                        results.append(('std:' + self.role_for_objtype(objtype),\n+                                        make_refnode(builder, fromdocname, docname,\n+                                                     labelid, contnode)))\n+                        break\n+            else:\n+                key = (objtype, target)\n+                if key in self.objects:\n+                    docname, labelid = self.objects[key]\n+                    results.append(('std:' + self.role_for_objtype(objtype),\n+                                    make_refnode(builder, fromdocname, docname,\n+                                                 labelid, contnode)))\n         return results\n \n     def get_objects(self) -> Iterator[Tuple[str, str, str, str, str, int]]:\ndiff --git a/tox.ini b/tox.ini\nindex d9f040544..bf39854b6 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -28,7 +28,7 @@ extras =\n setenv =\n     PYTHONWARNINGS = all,ignore::ImportWarning:importlib._bootstrap_external,ignore::DeprecationWarning:site,ignore::DeprecationWarning:distutils\n commands=\n-    pytest --durations 25 {posargs}\n+    pytest -rA --durations 25 {posargs}\n \n [testenv:flake8]\n basepython = python3\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-02-03T13:54:08.335594",
  "end_time": "2026-02-03T14:06:59.598991",
  "duration_seconds": 771.263397,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "b62a393e-3326-4dc2-ab16-194c1a63b971",
      "epic_title": "Fix: sphinx-doc__sphinx-7440",
      "comment_id": "36af76d5-aca1-4561-8c2c-d34627df031c",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nFixed the issue where glossary terms with different cases (e.g., \"MySQL\" and \"mysql\") were incorrectly flagged as duplicates.\n\nThe problem was that glossary terms were stored in a case-normalized (lowercased) form, which meant \"MySQL\" and \"mysql\" both became \"mysql\" and were treated as duplicates.\n\n## Root Cause\n\nIn `sphinx/domains/std.py`, line 308 was storing terms with `termtext.lower()`:\n```python\nstd.note_object('term', termtext.lower(), node_id, location=term)\n```\n\nThis caused both \"MySQL\" and \"mysql\" to be stored as `('term', 'mysql')`, triggering the duplicate warning.\n\n## Solution\n\n1. **Line 308**: Changed from `termtext.lower()` to `termtext` - stores terms with their original case\n2. **`_resolve_obj_xref` method**: Updated to do case-insensitive lookup for glossary terms\n3. **`resolve_any_xref` method**: Updated to do case-insensitive lookup for glossary terms\n\nThis allows terms with different cases to be stored separately while maintaining case-insensitive reference lookup (e.g., `:term:\\`MYSQL\\`` can find \"MySQL\").\n\n## Files Modified\n\n- `sphinx/domains/std.py`: Glossary term storage and lookup logic\n\n## Test Results\n\n**Baseline (before fix):**\n- \"MySQL\" and \"mysql\" in same glossary \u2192 WARNING: duplicate term description of mysql\n\n**After fix:**\n- \"MySQL\" and \"mysql\" in same glossary \u2192 No duplicate warning \u2713\n- All 7 glossary tests pass \u2713\n- 13/14 std domain tests pass (1 pre-existing failure in test_productionlist, unrelated to this fix)\n- Case-insensitive references still work: `:term:\\`MYSQL\\`` finds the term correctly \u2713\n\n## Edge Cases Considered\n\n- Terms with same text but different case (MySQL vs mysql) - now treated as different terms \u2713\n- Case-insensitive references - still work via fallback matching \u2713\n- Mixed case references like `:term:\\`MYSQL\\`` - correctly finds term \u2713\n- Normal single-case terms like \"Database\" - work correctly \u2713",
      "created_at": "2026-02-03T13:05:14.624Z"
    },
    {
      "epic_id": "b62a393e-3326-4dc2-ab16-194c1a63b971",
      "epic_title": "Fix: sphinx-doc__sphinx-7440",
      "comment_id": "0207c3df-dbe8-4981-b054-db99812f93ca",
      "author_name": "Code Reviewer",
      "content": "Code review PASSED.\n\nThe fix correctly addresses the problem: glossary terms with different cases (e.g., \"MySQL\" vs \"mysql\") were incorrectly treated as duplicates because `termtext.lower()` collapsed them. The fix stores terms with original case and adds case-insensitive fallback lookups in both `_resolve_obj_xref` and `resolve_any_xref`.\n\nReview checklist:\n- [x] No test files modified (source code only)\n- [x] No unrelated files modified (setup.py/tox.ini are auto-excluded build configs)\n- [x] Fix logically addresses the problem described in the problem statement\n- [x] No obvious crash bugs or logical errors introduced\n- [x] Changes are minimal and focused on the stated problem\n\nThe `for/else` pattern in `_resolve_obj_xref` and the `if/else` branching in `resolve_any_xref` are both correct. All code paths properly initialize `docname`/`labelid`. The `ltarget` variable in `resolve_any_xref` is already defined at line 957.",
      "created_at": "2026-02-03T13:06:48.073Z"
    }
  ]
}