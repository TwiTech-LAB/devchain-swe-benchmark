{
  "instance_id": "matplotlib__matplotlib-24870",
  "status": "completed",
  "patch": "diff --git a/lib/matplotlib/contour.py b/lib/matplotlib/contour.py\nindex 144eadeae2..a64486d7aa 100644\n--- a/lib/matplotlib/contour.py\n+++ b/lib/matplotlib/contour.py\n@@ -1446,15 +1446,39 @@ class QuadContourSet(ContourSet):\n         else:\n             fn = 'contour'\n         nargs = len(args)\n+        # Auto-detect boolean arrays and set default levels\n+        # Check if input is boolean and no explicit levels provided\n+        levels_provided = (self.levels is not None)\n         if nargs <= 2:\n+            # Check if the input array is boolean before conversion\n+            z_input = np.asarray(args[0])\n+            z_is_bool = (z_input.dtype == bool)\n             z = ma.asarray(args[0], dtype=np.float64)\n             x, y = self._initialize_x_y(z)\n             args = args[1:]\n+            if not levels_provided:\n+                levels_provided = (len(args) > 0 and args[0] is not None)\n         elif nargs <= 4:\n+            # Check if Z is boolean before conversion\n+            z_input = np.asarray(args[2])\n+            z_is_bool = (z_input.dtype == bool)\n             x, y, z = self._check_xyz(args[:3], kwargs)\n             args = args[3:]\n+            if not levels_provided:\n+                levels_provided = (len(args) > 0 and args[0] is not None)\n         else:\n             raise _api.nargs_error(fn, takes=\"from 1 to 4\", given=nargs)\n+\n+        # For boolean arrays with no explicit levels, set appropriate defaults\n+        if z_is_bool and not levels_provided:\n+            if self.filled:\n+                # Filled contours need at least 2 levels. Use [0.0, 1.0] to define\n+                # the boundary between False and True regions.\n+                self.levels = [0.0, 1.0]\n+            else:\n+                # Line contours: single level at 0.5 to show the boundary.\n+                self.levels = [0.5]\n+\n         z = ma.masked_invalid(z, copy=False)\n         self.zmax = float(z.max())\n         self.zmin = float(z.min())\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-02-03T13:25:23.972616",
  "end_time": "2026-02-03T13:34:56.399075",
  "duration_seconds": 572.426459,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "1415b7b9-db47-4bd8-bcb1-17db76eb170a",
      "epic_title": "Fix: matplotlib__matplotlib-24870",
      "comment_id": "4299dba0-7131-46d6-864d-d25266ee1feb",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nImplemented auto-detection of boolean arrays passed to `contour()` and `contourf()`. When a boolean array is detected and no explicit levels are provided:\n- **Line contours (`contour()`)**: Default to a single level at `[0.5]` to show the boundary between True and False regions\n- **Filled contours (`contourf()`)**: Default to `[0.0, 1.0]` to properly define the two regions (filled contours require at least 2 levels)\n\n## Files Modified\n- **lib/matplotlib/contour.py**: Modified `QuadContourSet._contour_args()` method to:\n  1. Detect boolean input arrays before they are converted to float64\n  2. Track whether levels were explicitly provided (via `self.levels` or positional args)\n  3. Set appropriate default levels for boolean arrays when none were provided\n\n## Test Results\n- **Test file:** /testbed/lib/matplotlib/tests/test_contour.py\n- **Baseline (before fix):** 65 passed, 1 skipped\n- **After fix:** 65 passed, 1 skipped\n- **Regression check:** No new failures introduced\n\n## Additional Verification\nTested the following scenarios:\n1. Boolean array without levels \u2192 defaults to [0.5] for contour, [0.0, 1.0] for contourf \u2713\n2. Boolean array with explicit levels \u2192 uses provided levels \u2713\n3. Numeric array without levels \u2192 uses default behavior (7 levels \u2192 8 via MaxNLocator) \u2713\n4. Boolean array with X, Y specified \u2192 works correctly \u2713\n5. Boolean array with integer level count \u2192 uses autolev with that count \u2713\n6. Original issue example (boolean 2D array) \u2192 now produces single level at 0.5 \u2713\n\n## Edge Cases Handled\n- All True or all False arrays: Existing code handles these by adjusting levels when no levels are within the data range\n- Small arrays (2x2): Works correctly\n- Masked arrays: Boolean detection works on the underlying array before masking\n\n## Concerns\n- The behavior for all-True or all-False boolean arrays results in a warning \"No contour levels were found within the data range\" and levels are adjusted to [zmin]. This is expected behavior from the existing validation code.",
      "created_at": "2026-02-03T12:32:43.795Z"
    },
    {
      "epic_id": "1415b7b9-db47-4bd8-bcb1-17db76eb170a",
      "epic_title": "Fix: matplotlib__matplotlib-24870",
      "comment_id": "a6b102c0-6db7-4666-9b87-b85a75a074f5",
      "author_name": "Code Reviewer",
      "content": "## Code Review PASSED\n\n**Reviewed:** `lib/matplotlib/contour.py` \u2014 `QuadContourSet._contour_args()` method\n\n**Checklist:**\n- \u2705 No test files modified (source code only)\n- \u2705 No unrelated files modified\n- \u2705 Fix logically addresses the problem described in the problem statement\n- \u2705 No obvious crash bugs or logical errors introduced\n- \u2705 Changes are minimal and focused\n\n**Analysis:**\n\nThe fix correctly:\n1. Detects boolean dtype on the input array *before* it's converted to float64 (using `np.asarray(args[...]).dtype == bool`)\n2. Tracks whether levels were explicitly provided via keyword (`self.levels is not None`) or positional arg (`len(args) > 0 and args[0] is not None`)\n3. Sets `self.levels = [0.5]` for line contours and `self.levels = [0.0, 1.0]` for filled contours when the input is boolean and no explicit levels were given\n4. The set levels flow correctly into `_process_contour_level_args`: since `self.levels` is no longer `None`, it enters the `levels_arg = self.levels` path and converts to a float64 array \u2014 no interference with existing logic\n5. Edge cases (all-True/all-False arrays) are handled by existing validation code that warns when no levels fall within the data range\n\nTest results confirm no regressions (65 passed, 1 skipped \u2014 same as baseline).",
      "created_at": "2026-02-03T12:34:44.755Z"
    }
  ]
}