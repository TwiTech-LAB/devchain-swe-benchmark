{
  "instance_id": "astropy__astropy-13033",
  "status": "completed",
  "patch": "diff --git a/astropy/timeseries/core.py b/astropy/timeseries/core.py\nindex c279f35f87..08198fb827 100644\n--- a/astropy/timeseries/core.py\n+++ b/astropy/timeseries/core.py\n@@ -76,9 +76,23 @@ class BaseTimeSeries(QTable):\n \n             elif self.colnames[:len(required_columns)] != required_columns:\n \n-                raise ValueError(\"{} object is invalid - expected '{}' \"\n-                                 \"as the first column{} but found '{}'\"\n-                                 .format(self.__class__.__name__, required_columns[0], plural, self.colnames[0]))\n+                # Check which required columns are missing from the table\n+                missing_columns = [col for col in required_columns if col not in self.colnames]\n+\n+                # If first column is correct but other required columns are missing,\n+                # provide a clear message about missing columns\n+                if missing_columns and self.colnames and self.colnames[0] == required_columns[0]:\n+                    missing_str = ', '.join(repr(col) for col in missing_columns)\n+                    raise ValueError(\"{} object is invalid - time series is missing \"\n+                                     \"required column{}: {}\"\n+                                     .format(self.__class__.__name__, 's' if len(missing_columns) > 1 else '',\n+                                             missing_str))\n+                else:\n+                    # First column is wrong or table is empty\n+                    raise ValueError(\"{} object is invalid - expected '{}' \"\n+                                     \"as the first column{} but found '{}'\"\n+                                     .format(self.__class__.__name__, required_columns[0], plural,\n+                                             self.colnames[0] if len(self.colnames) > 0 else 'no columns'))\n \n             if (self._required_columns_relax\n                     and self._required_columns == self.colnames[:len(self._required_columns)]):\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-02-03T10:06:15.250564",
  "end_time": "2026-02-03T10:16:12.673077",
  "duration_seconds": 597.422513,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "0cefff6d-42f8-4111-ad64-56c057f9dfff",
      "epic_title": "Fix: astropy__astropy-13033",
      "comment_id": "53d830f3-eb41-49ef-8a90-df7146f22b15",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nFixed the misleading exception message in `TimeSeries._check_required_columns()` when required columns are missing.\n\n**Problem**: When a `TimeSeries` object has additional required columns (beyond the default 'time'), and a required column (other than the first) is removed, the error message was confusing:\n```\nValueError: TimeSeries object is invalid - expected 'time' as the first columns but found 'time'\n```\n\n**Root Cause**: The validation logic only checked if `colnames[:len(required_columns)] != required_columns` and showed a generic \"expected X but found Y\" message using only the first element of each list. When the first column was correct but other required columns were missing, this resulted in the confusing \"expected 'time' but found 'time'\" message.\n\n**Solution**: Added logic to detect when the first column is correct but other required columns are missing. In this case, provide a clear message listing all missing required columns:\n```\nValueError: TimeSeries object is invalid - time series is missing required column: 'flux'\n```\n\n## Files Modified\n- `astropy/timeseries/core.py`: Modified `_check_required_columns()` method\n\n## Test Results\n- **Test file**: `astropy/timeseries/tests/test_sampled.py`\n- **Baseline (before fix)**: 21 passed, 1 failed, 3 skipped\n- **After fix**: 21 passed, 1 failed, 3 skipped\n- **Regression check**: No new failures introduced. The 1 pre-existing failure is due to IERS leap second warning unrelated to this fix.\n\n## Additional Verification\n\nVerified the fix handles all cases correctly:\n1. **Missing required columns (first is correct)**: Shows clear message about missing columns\n2. **Wrong first column**: Shows old-style message \"expected 'time' but found 'X'\"\n3. **Empty table**: Shows appropriate message\n4. **Multiple missing columns**: Lists all missing columns\n\nTest case from issue:\n```python\nfrom astropy.time import Time\nfrom astropy.timeseries import TimeSeries\ntime = Time(np.arange(100000, 100003), format='jd')\nts = TimeSeries(time=time, data={\"flux\": [99.9, 99.8, 99.7]})\nts._required_columns = [\"time\", \"flux\"]\nts.remove_column(\"flux\")\n```\nNow produces: `TimeSeries object is invalid - time series is missing required column: 'flux'`\n\n## Concerns\nNone - The fix is minimal, focused, and handles all edge cases correctly.",
      "created_at": "2026-02-03T09:14:34.531Z"
    },
    {
      "epic_id": "0cefff6d-42f8-4111-ad64-56c057f9dfff",
      "epic_title": "Fix: astropy__astropy-13033",
      "comment_id": "d502f7e5-13ad-48bc-a72f-4c15c8802fac",
      "author_name": "Code Reviewer",
      "content": "## Code Review PASSED\n\n**Changes reviewed:** `astropy/timeseries/core.py` - `_check_required_columns()` method\n\n**Checklist:**\n- \u2705 No test files modified\n- \u2705 No unrelated files modified (pyproject.toml auto-excluded)\n- \u2705 Fix logically addresses the problem\n- \u2705 No crash bugs or logical errors introduced\n- \u2705 Changes are minimal and focused\n\n**Assessment:**\nThe fix correctly distinguishes between two error cases in the `elif self.colnames[:len(required_columns)] != required_columns` branch:\n\n1. **Missing required columns (first column correct):** Now shows a clear message listing the missing columns, e.g., `\"TimeSeries object is invalid - time series is missing required column: 'flux'\"`\n2. **Wrong first column:** Preserves the original error message style.\n\nThe logic is sound:\n- `missing_columns` is computed correctly by checking which required columns are absent from `self.colnames`\n- The guard `self.colnames and self.colnames[0] == required_columns[0]` safely handles edge cases\n- The empty table case is already caught by the preceding `len(self.colnames) == 0` branch (line 71), so the defensive check in the else branch is just a safety measure\n- Multiple missing columns are handled with proper pluralization\n\nNo regressions. The Brainstormer's test results confirm identical pass/fail counts before and after the fix (21 passed, 1 pre-existing failure unrelated to this change, 3 skipped).",
      "created_at": "2026-02-03T09:16:06.081Z"
    }
  ]
}