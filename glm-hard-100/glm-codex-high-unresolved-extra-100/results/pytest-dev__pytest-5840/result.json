{
  "instance_id": "pytest-dev__pytest-5840",
  "status": "completed",
  "patch": "diff --git a/src/_pytest/config/__init__.py b/src/_pytest/config/__init__.py\nindex 3a0eca546..e36ca7b4f 100644\n--- a/src/_pytest/config/__init__.py\n+++ b/src/_pytest/config/__init__.py\n@@ -435,9 +435,11 @@ class PytestPluginManager(PluginManager):\n         # Use realpath to avoid loading the same conftest twice\n         # with build systems that create build directories containing\n         # symlinks to actual files.\n-        conftestpath = unique_path(conftestpath)\n+        # Use unique_path for deduplication key only (not for import operations)\n+        # because normcase on Windows lowercases paths which can break imports.\n+        conftestpath_key = unique_path(conftestpath)\n         try:\n-            return self._conftestpath2mod[conftestpath]\n+            return self._conftestpath2mod[conftestpath_key]\n         except KeyError:\n             pkgpath = conftestpath.pypkgpath()\n             if pkgpath is None:\n@@ -454,7 +456,7 @@ class PytestPluginManager(PluginManager):\n                 raise ConftestImportFailure(conftestpath, sys.exc_info())\n \n             self._conftest_plugins.add(mod)\n-            self._conftestpath2mod[conftestpath] = mod\n+            self._conftestpath2mod[conftestpath_key] = mod\n             dirpath = conftestpath.dirpath()\n             if dirpath in self._dirpath2confmods:\n                 for path, mods in self._dirpath2confmods.items():\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-02-03T01:09:58.499747",
  "end_time": "2026-02-03T01:16:58.737876",
  "duration_seconds": 420.238129,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "2e7ea230-0a1a-4bfd-8abd-7e47884f2379",
      "epic_title": "Fix: pytest-dev__pytest-5840",
      "comment_id": "1cafb477-204e-4807-8b4a-d86b497a01cb",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nFixed the Windows path casing issue in pytest 5.1.2 that caused `ImportError` while loading conftest files.\n\n### Root Cause\n\nThe `unique_path()` function uses `os.path.normcase()` to normalize paths. On Windows, `normcase()` converts paths to lowercase. This normalized path was being used for both:\n1. Cache key deduplication (in `_conftestpath2mod`)\n2. The actual module import operation via `pyimport()`\n\nWhen the lowercased path was used for `pyimport()`, it could cause import failures because Python's import system relies on the actual path casing to correctly identify the module.\n\n### Solution\n\nModified `_importconftest()` in `src/_pytest/config/__init__.py` to:\n- Use `unique_path()` only for the cache key (`conftestpath_key`) to ensure deduplication\n- Keep the original `conftestpath` for all import operations (`pypkgpath()`, `pyimport()`, etc.)\n\nThis ensures that:\n1. Conftest files are still deduplicated correctly (avoiding symlink issues)\n2. The actual import uses the correct path casing, avoiding Windows import errors\n\n## Files Modified\n\n- `src/_pytest/config/__init__.py`: Modified `_importconftest()` method to use `unique_path()` only for cache deduplication, not for import operations.\n\n## Test Results\n\n- **Test file:** testing/test_conftest.py\n- **After fix:** 52 passed, 1 skipped (badcase test is skipped on Linux - only relevant for Windows)\n- **Regression check:** No new failures introduced\n- **Additional tests:** testing/test_collection.py (71 passed), testing/test_pathlib.py (39 passed)\n\n## Concerns\n\n- The fix is minimal and focused on the specific issue\n- The test `test_conftest_badcase` exists for this issue but is skipped on Linux (case-sensitive filesystems)\n- The pre-existing test failure in `test_config.py::TestPytestPluginsVariable::test_pytest_plugins_in_non_top_level_conftest_unsupported_pyargs[True]` is unrelated to this fix (it's a deprecation warning from pkg_resources)",
      "created_at": "2026-02-03T00:15:43.138Z"
    },
    {
      "epic_id": "2e7ea230-0a1a-4bfd-8abd-7e47884f2379",
      "epic_title": "Fix: pytest-dev__pytest-5840",
      "comment_id": "2584f33e-0d3a-4697-b248-68156f2116d4",
      "author_name": "Code Reviewer",
      "content": "Code review PASSED.\n\n- Only source file modified (`src/_pytest/config/__init__.py`); no tests/build configs changed.\n- Fix cleanly targets the reported Windows casing regression: `unique_path()` (via `normcase`) is now used only for the `_conftestpath2mod` deduplication key, while import operations keep the original `conftestpath`.\n- Diff is minimal and has no obvious crash/logic issues for the described scenario.",
      "created_at": "2026-02-03T00:16:47.110Z"
    }
  ]
}