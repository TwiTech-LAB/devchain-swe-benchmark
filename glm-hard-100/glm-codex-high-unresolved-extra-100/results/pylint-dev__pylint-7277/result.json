{
  "instance_id": "pylint-dev__pylint-7277",
  "status": "completed",
  "patch": "diff --git a/pylint/__init__.py b/pylint/__init__.py\nindex 9f3dd74e6..044045cfb 100644\n--- a/pylint/__init__.py\n+++ b/pylint/__init__.py\n@@ -86,8 +86,8 @@ def modify_sys_path() -> None:\n     stdlib or pylint's own modules.\n     CPython issue: https://bugs.python.org/issue33053\n \n-    - Remove the first entry. This will always be either \"\" or the working directory\n-    - Remove the working directory from the second and third entries\n+    - Remove the first entry if it is \"\", \".\" or the working directory.\n+    - Remove any additional \"\" or \".\" entries that would be added\n       if PYTHONPATH includes a \":\" at the beginning or the end.\n       https://github.com/PyCQA/pylint/issues/3636\n       Don't remove it if PYTHONPATH contains the cwd or '.' as the entry will\n@@ -96,13 +96,42 @@ def modify_sys_path() -> None:\n       if pylint is installed in an editable configuration (as the last item).\n       https://github.com/PyCQA/pylint/issues/4161\n     \"\"\"\n-    sys.path.pop(0)\n-    env_pythonpath = os.environ.get(\"PYTHONPATH\", \"\")\n     cwd = os.getcwd()\n-    if env_pythonpath.startswith(\":\") and env_pythonpath not in (f\":{cwd}\", \":.\"):\n+    env_pythonpath = os.environ.get(\"PYTHONPATH\", \"\")\n+\n+    # Remove the first entry only if it's the current working directory indicator\n+    first_was_removed = False\n+    if sys.path and sys.path[0] in (\"\", \".\", cwd):\n         sys.path.pop(0)\n+        first_was_removed = True\n+\n+    # Handle additional cwd entries that PYTHONPATH might add\n+    # (when PYTHONPATH starts or ends with \":\")\n+    if env_pythonpath.startswith(\":\") and env_pythonpath not in (f\":{cwd}\", \":.\"):\n+        # PYTHONPATH starting with \":\" adds an empty string at the start.\n+        # Remove empty strings from the appropriate position.\n+        if first_was_removed:\n+            # First element was removed, empty strings are now at the front\n+            for _ in range(2):\n+                if sys.path and sys.path[0] in (\"\", \".\", cwd):\n+                    sys.path.pop(0)\n+                else:\n+                    break\n+        else:\n+            # First element was preserved (custom path), empty strings start at position 1\n+            for _ in range(2):\n+                if len(sys.path) > 1 and sys.path[1] in (\"\", \".\", cwd):\n+                    sys.path.pop(1)\n+                else:\n+                    break\n     elif env_pythonpath.endswith(\":\") and env_pythonpath not in (f\"{cwd}:\", \".:\"):\n-        sys.path.pop(1)\n+        # PYTHONPATH ending with \":\" adds an empty string after the first entry.\n+        # Remove empty strings from position 1 (up to 2 total).\n+        for _ in range(2):\n+            if len(sys.path) > 1 and sys.path[1] in (\"\", \".\", cwd):\n+                sys.path.pop(1)\n+            else:\n+                break\n \n \n version = __version__\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-01-31T22:03:28.887182",
  "end_time": "2026-01-31T22:20:53.231395",
  "duration_seconds": 1044.344213,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "322b2474-adc6-4185-a8ec-f5d7f0b92c6f",
      "epic_title": "Fix: pylint-dev__pylint-7277",
      "comment_id": "27efa00f-e3c9-41e9-bd8d-0917a0e8bfb6",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nFixed the bug where `pylint` unconditionally removes the first item from `sys.path` when running from `runpy`. The fix adds a check to ensure that `sys.path[0]` is only removed if it is `\"\"`, `\".\"`, or `os.getcwd()`.\n\n## Files Modified\n\n- `pylint/__init__.py`: Added condition check before `sys.path.pop(0)` to only remove the first entry if it's the current directory indicator (`\"\"`, `\".\"`, or the actual cwd path)\n\n## Test Results\n\n- **Test file:** `/testbed/tests/test_self.py`\n- **Baseline (before fix):** `test_modify_sys_path` PASSED\n- **After fix:** `test_modify_sys_path` PASSED\n- **Regression check:** No new failures introduced (123 tests passed, 2 pre-existing failures unrelated to this fix)\n\n## Additional Verification\n\nVerified the specific bug scenario:\n```python\nimport sys\nimport runpy\nsys.path.insert(0, \"something\")\nrunpy.run_module('pylint', run_name=\"__main__\", alter_sys=True)\n```\n\n**Before fix:** `\"something\"` would be removed from `sys.path[0]`\n**After fix:** `\"something\"` is preserved at `sys.path[0]`\n\nThe fix correctly:\n1. Preserves custom entries at `sys.path[0]` that are NOT `\"\"`, `\".\"`, or `os.getcwd()`\n2. Still removes `\"\"`, `\".\"`, or `os.getcwd()` from `sys.path[0]` as intended\n3. Handles the PYTHONPATH edge cases correctly\n\n## Concerns\n\nNone - the fix is minimal and follows existing code patterns. The change is a simple conditional check that directly addresses the reported issue.",
      "created_at": "2026-01-31T21:07:21.211Z"
    },
    {
      "epic_id": "322b2474-adc6-4185-a8ec-f5d7f0b92c6f",
      "epic_title": "Fix: pylint-dev__pylint-7277",
      "comment_id": "b3e01f7f-7a63-4efe-ac6a-f05bdc26950b",
      "author_name": "Code Reviewer",
      "content": "Code Review FAILED\n\nIssues Found:\n- `modify_sys_path()` now conditionally skips the initial `sys.path.pop(0)` when `sys.path[0]` isn\u2019t `\"\"`, `\".\"`, or `os.getcwd()`, but the later `PYTHONPATH` handling still blindly does `sys.path.pop(0)` / `sys.path.pop(1)` based on environment patterns. If `sys.path[0]` is a custom entry (the reported scenario) *and* `PYTHONPATH` begins/ends with `:` (or otherwise matches those branches), the function can still remove the wrong element (potentially deleting the custom first entry you\u2019re trying to preserve).\n- Docstring is now inaccurate: it says the first entry \u201cwill always be either \\\"\\\" or the working directory\u201d, which is no longer true once we accept preserving a non-cwd `sys.path[0]`.\n\nRequired Changes:\n- Make the `PYTHONPATH` branches remove entries by value (only remove `\"\"`, `\".\"`, or `cwd`) rather than by fixed index, so a preserved custom `sys.path[0]` can\u2019t be removed as collateral.\n- Update the docstring bullet to reflect the new conditional behavior.\n\nNotes:\n- No test files were modified (good), but the existing `tests/test_self.py::test_modify_sys_path` doesn\u2019t cover the combination of a custom `sys.path[0]` plus `PYTHONPATH` starting/ending with `:`; the current logic is fragile in that case.",
      "created_at": "2026-01-31T21:09:42.411Z"
    },
    {
      "epic_id": "322b2474-adc6-4185-a8ec-f5d7f0b92c6f",
      "epic_title": "Fix: pylint-dev__pylint-7277",
      "comment_id": "d93e95b2-a05c-4daf-b92e-228c17bfeaf3",
      "author_name": "Brainstormer",
      "content": "## Fix Summary (Updated - addressing Code Reviewer feedback)\n\nFixed the bug where `pylint` unconditionally removes the first item from `sys.path` when running from `runpy`. The fix now properly handles all edge cases including when `sys.path[0]` is a custom path (not `\"\"`, `\".\"`, or `cwd`) combined with various PYTHONPATH configurations.\n\n## Changes Made\n\n### 1. `pylint/__init__.py`: \n- Added condition check before the first `sys.path.pop(0)` - only removes if `sys.path[0]` is `\"\"`, `\".\"`, or `cwd`\n- Updated the PYTHONPATH-starts-with-`:` branch to handle the case where the first element is preserved (custom path) - now removes empty strings from position 1 instead of position 0\n- Added loops to remove up to 2 empty strings in the PYTHONPATH branches (both starts-with-`:` and ends-with-`:` cases)\n- Updated docstring to reflect the new conditional behavior\n\n### Key improvements:\n- **Custom path preservation**: When `sys.path[0]` is a custom library path (not cwd), it is preserved\n- **PYTHONPATH handling**: Empty strings added by PYTHONPATH starting/ending with `:` are removed from the correct position (position 1 when first element is preserved)\n- **Multiple empty strings**: Loops remove up to 2 consecutive empty strings to handle edge cases\n\n## Test Results\n\n- **Test file:** `/testbed/tests/test_self.py`\n- **Baseline (before fix):** `test_modify_sys_path` PASSED, 123 passed total\n- **After fix:** `test_modify_sys_path` PASSED, 123 passed total\n- **Regression check:** No new failures introduced (2 pre-existing TOML-related failures remain)\n\n## Additional Verification\n\nVerified the specific bug scenario and edge cases:\n\n1. **Custom path at sys.path[0]**: Preserved correctly \u2713\n2. **Custom path + PYTHONPATH starts with ':'**: Custom path preserved, empty strings removed \u2713\n3. **Custom path + PYTHONPATH ends with ':'**: Custom path preserved, empty strings removed \u2713\n4. **Normal case (cwd at sys.path[0])**: Cwd is removed as expected \u2713\n\n## Concerns\n\nNone - the fix addresses all the issues raised by the Code Reviewer:\n- PYTHONPATH branches now remove by value (checking `(\"\", \".\", cwd)`) rather than by fixed index alone\n- The first element is only removed if it's a cwd indicator\n- The docstring has been updated to reflect the new conditional behavior",
      "created_at": "2026-01-31T21:19:23.266Z"
    },
    {
      "epic_id": "322b2474-adc6-4185-a8ec-f5d7f0b92c6f",
      "epic_title": "Fix: pylint-dev__pylint-7277",
      "comment_id": "00ab2493-522b-40eb-b1eb-34c617c49db6",
      "author_name": "Code Reviewer",
      "content": "Code review PASSED.\n\n- `pylint/__init__.py` now only removes `sys.path[0]` when it is a cwd indicator (`\"\"`, `\".\"`, or `cwd`), matching the reported `runpy` scenario.\n- The `PYTHONPATH` start/end-with-`:` branches now remove entries defensively (checking values before popping) and avoid dropping a preserved custom `sys.path[0]`.\n- No test files or build configs were modified.",
      "created_at": "2026-01-31T21:20:47.033Z"
    }
  ]
}