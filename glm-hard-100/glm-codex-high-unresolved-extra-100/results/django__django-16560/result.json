{
  "instance_id": "django__django-16560",
  "status": "completed",
  "patch": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..0178467783 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -19,10 +19,12 @@ __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"\n class BaseConstraint:\n     default_violation_error_message = _(\"Constraint \u201c%(name)s\u201d is violated.\")\n     violation_error_message = None\n+    default_violation_error_code = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,10 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n+        else:\n+            self.violation_error_code = self.default_violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -42,7 +48,7 @@ class BaseConstraint:\n                 RemovedInDjango60Warning,\n                 stacklevel=2,\n             )\n-            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n+            for arg, attr in zip(args, [\"name\", \"violation_error_message\", \"violation_error_code\"]):\n                 if arg:\n                     setattr(self, attr, arg)\n \n@@ -74,6 +80,11 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if (\n+            self.violation_error_code is not None\n+            and self.violation_error_code != self.default_violation_error_code\n+        ):\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -82,13 +93,13 @@ class BaseConstraint:\n \n \n class CheckConstraint(BaseConstraint):\n-    def __init__(self, *, check, name, violation_error_message=None):\n+    def __init__(self, *, check, name, violation_error_message=None, violation_error_code=None):\n         self.check = check\n         if not getattr(check, \"conditional\", False):\n             raise TypeError(\n                 \"CheckConstraint.check must be a Q instance or boolean expression.\"\n             )\n-        super().__init__(name=name, violation_error_message=violation_error_message)\n+        super().__init__(name=name, violation_error_message=violation_error_message, violation_error_code=violation_error_code)\n \n     def _get_check_sql(self, model, schema_editor):\n         query = Query(model=model, alias_cols=False)\n@@ -112,12 +123,14 @@ class CheckConstraint(BaseConstraint):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise ValidationError(\n+                    self.get_violation_error_message(), code=self.violation_error_code\n+                )\n         except FieldError:\n             pass\n \n     def __repr__(self):\n-        return \"<%s: check=%s name=%s%s>\" % (\n+        return \"<%s: check=%s name=%s%s%s>\" % (\n             self.__class__.__qualname__,\n             self.check,\n             repr(self.name),\n@@ -127,6 +140,12 @@ class CheckConstraint(BaseConstraint):\n                 or self.violation_error_message == self.default_violation_error_message\n                 else \" violation_error_message=%r\" % self.violation_error_message\n             ),\n+            (\n+                \"\"\n+                if self.violation_error_code is None\n+                or self.violation_error_code == self.default_violation_error_code\n+                else \" violation_error_code=%r\" % self.violation_error_code\n+            ),\n         )\n \n     def __eq__(self, other):\n@@ -135,6 +154,7 @@ class CheckConstraint(BaseConstraint):\n                 self.name == other.name\n                 and self.check == other.check\n                 and self.violation_error_message == other.violation_error_message\n+                and self.violation_error_code == other.violation_error_code\n             )\n         return super().__eq__(other)\n \n@@ -164,6 +184,7 @@ class UniqueConstraint(BaseConstraint):\n         include=None,\n         opclasses=(),\n         violation_error_message=None,\n+        violation_error_code=None,\n     ):\n         if not name:\n             raise ValueError(\"A unique constraint must be named.\")\n@@ -213,7 +234,7 @@ class UniqueConstraint(BaseConstraint):\n             F(expression) if isinstance(expression, str) else expression\n             for expression in expressions\n         )\n-        super().__init__(name=name, violation_error_message=violation_error_message)\n+        super().__init__(name=name, violation_error_message=violation_error_message, violation_error_code=violation_error_code)\n \n     @property\n     def contains_expressions(self):\n@@ -293,7 +314,7 @@ class UniqueConstraint(BaseConstraint):\n         )\n \n     def __repr__(self):\n-        return \"<%s:%s%s%s%s%s%s%s%s>\" % (\n+        return \"<%s:%s%s%s%s%s%s%s%s%s>\" % (\n             self.__class__.__qualname__,\n             \"\" if not self.fields else \" fields=%s\" % repr(self.fields),\n             \"\" if not self.expressions else \" expressions=%s\" % repr(self.expressions),\n@@ -308,6 +329,12 @@ class UniqueConstraint(BaseConstraint):\n                 or self.violation_error_message == self.default_violation_error_message\n                 else \" violation_error_message=%r\" % self.violation_error_message\n             ),\n+            (\n+                \"\"\n+                if self.violation_error_code is None\n+                or self.violation_error_code == self.default_violation_error_code\n+                else \" violation_error_code=%r\" % self.violation_error_code\n+            ),\n         )\n \n     def __eq__(self, other):\n@@ -321,6 +348,7 @@ class UniqueConstraint(BaseConstraint):\n                 and self.opclasses == other.opclasses\n                 and self.expressions == other.expressions\n                 and self.violation_error_message == other.violation_error_message\n+                and self.violation_error_code == other.violation_error_code\n             )\n         return super().__eq__(other)\n \n@@ -385,7 +413,9 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise ValidationError(\n+                        self.get_violation_error_message(), code=self.violation_error_code\n+                    )\n                 # When fields are defined, use the unique_error_message() for\n                 # backward compatibility.\n                 for model, constraints in instance.get_constraints():\n@@ -400,6 +430,8 @@ class UniqueConstraint(BaseConstraint):\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise ValidationError(\n+                        self.get_violation_error_message(), code=self.violation_error_code\n+                    )\n             except FieldError:\n                 pass\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-02-01T06:46:18.493359",
  "end_time": "2026-02-01T06:57:41.700606",
  "duration_seconds": 683.207247,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "31c2cad4-e3aa-46fd-833d-df75f7df59bd",
      "epic_title": "Fix: django__django-16560",
      "comment_id": "2fe445c5-213a-472a-9d1f-a57a3f9f3347",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nImplemented the `violation_error_code` parameter for `BaseConstraint` and its subclasses (`CheckConstraint`, `UniqueConstraint`). This allows users to customize the error code of the `ValidationError` raised when a constraint is violated, similar to how `violation_error_message` already works.\n\n## Files Modified\n\n- `django/db/models/constraints.py`:\n  - **BaseConstraint**: Added `default_violation_error_code = None` and `violation_error_code = None` class attributes\n  - **BaseConstraint.__init__**: Added `violation_error_code` parameter (with deprecation warning support for positional args)\n  - **BaseConstraint.deconstruct()**: Added logic to include `violation_error_code` in kwargs when customized\n  - **CheckConstraint**: Added `violation_error_code` parameter to `__init__` and passes it to parent\n  - **CheckConstraint.validate()**: Updated to pass `code=self.violation_error_code` to `ValidationError`\n  - **CheckConstraint.__repr__**: Updated to show `violation_error_code` when customized\n  - **CheckConstraint.__eq__**: Updated to compare `violation_error_code`\n  - **UniqueConstraint**: Added `violation_error_code` parameter to `__init__` and passes it to parent\n  - **UniqueConstraint.validate()**: Updated to pass `code=self.violation_error_code` to `ValidationError` (in both places where it's raised)\n  - **UniqueConstraint.__repr__**: Updated to show `violation_error_code` when customized\n  - **UniqueConstraint.__eq__**: Updated to compare `violation_error_code`\n\n## Test Results\n\n- **Test files run**: `tests/validation/test_constraints.py` and `tests/postgres_tests/test_constraints.py`\n- **Baseline (before fix)**: 56 tests passed\n- **After fix**: 56 tests passed, 49 skipped (PostgreSQL tests require Postgres)\n- **Regression check**: No new failures introduced\n- **All validation tests**: 61 tests passed\n\n## Additional Verification\n\nCreated and ran a verification script that confirmed:\n1. `CheckConstraint` accepts and stores `violation_error_code`\n2. `UniqueConstraint` accepts and stores `violation_error_code`\n3. Default value is `None` when not provided\n4. `__repr__` includes `violation_error_code` when customized\n5. `__eq__` correctly compares `violation_error_code`\n6. Both `violation_error_message` and `violation_error_code` can be customized together\n\n## Concerns\n\nNone. The implementation follows the existing pattern used for `violation_error_message`, maintaining consistency with the codebase.",
      "created_at": "2026-02-01T05:55:18.177Z"
    },
    {
      "epic_id": "31c2cad4-e3aa-46fd-833d-df75f7df59bd",
      "epic_title": "Fix: django__django-16560",
      "comment_id": "4742d49e-bb5d-4ac0-899b-343df4e1c785",
      "author_name": "Code Reviewer",
      "content": "Code review PASSED.\n\n- Scope is minimal: only `django/db/models/constraints.py` changed; no tests/build configs touched.\n- Implementation matches request: new `violation_error_code` is accepted/serialized and propagated to `ValidationError` in `CheckConstraint.validate()` and the constraint-specific `UniqueConstraint.validate()` branches.\n- Verification is adequate (baseline vs after + actual test modules run as reported).",
      "created_at": "2026-02-01T05:57:30.976Z"
    }
  ]
}