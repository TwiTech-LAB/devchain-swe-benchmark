{
  "instance_id": "django__django-13195",
  "status": "completed",
  "patch": "diff --git a/django/contrib/messages/storage/cookie.py b/django/contrib/messages/storage/cookie.py\nindex 78256ca3b2..895ec59fbf 100644\n--- a/django/contrib/messages/storage/cookie.py\n+++ b/django/contrib/messages/storage/cookie.py\n@@ -92,7 +92,13 @@ class CookieStorage(BaseStorage):\n                 samesite=settings.SESSION_COOKIE_SAMESITE,\n             )\n         else:\n-            response.delete_cookie(self.cookie_name, domain=settings.SESSION_COOKIE_DOMAIN)\n+            response.delete_cookie(\n+                self.cookie_name,\n+                domain=settings.SESSION_COOKIE_DOMAIN,\n+                samesite=settings.SESSION_COOKIE_SAMESITE,\n+                httponly=settings.SESSION_COOKIE_HTTPONLY or None,\n+                secure=settings.SESSION_COOKIE_SECURE or None,\n+            )\n \n     def _store(self, messages, response, remove_oldest=True, *args, **kwargs):\n         \"\"\"\ndiff --git a/django/contrib/sessions/middleware.py b/django/contrib/sessions/middleware.py\nindex 63013eef7a..87bbf46ee6 100644\n--- a/django/contrib/sessions/middleware.py\n+++ b/django/contrib/sessions/middleware.py\n@@ -42,6 +42,9 @@ class SessionMiddleware(MiddlewareMixin):\n                 settings.SESSION_COOKIE_NAME,\n                 path=settings.SESSION_COOKIE_PATH,\n                 domain=settings.SESSION_COOKIE_DOMAIN,\n+                samesite=settings.SESSION_COOKIE_SAMESITE,\n+                httponly=settings.SESSION_COOKIE_HTTPONLY or None,\n+                secure=settings.SESSION_COOKIE_SECURE or None,\n             )\n             patch_vary_headers(response, ('Cookie',))\n         else:\ndiff --git a/django/http/response.py b/django/http/response.py\nindex e00bcacefb..09d915a3b8 100644\n--- a/django/http/response.py\n+++ b/django/http/response.py\n@@ -210,13 +210,19 @@ class HttpResponseBase:\n         value = signing.get_cookie_signer(salt=key + salt).sign(value)\n         return self.set_cookie(key, value, **kwargs)\n \n-    def delete_cookie(self, key, path='/', domain=None):\n+    def delete_cookie(self, key, path='/', domain=None, samesite=None, httponly=False, secure=False):\n+        \"\"\"\n+        Delete a cookie by setting it with an expiry date in the past.\n+\n+        `samesite` should be one of the values supported by `set_cookie`.\n+        \"\"\"\n         # Most browsers ignore the Set-Cookie header if the cookie name starts\n         # with __Host- or __Secure- and the cookie doesn't use the secure flag.\n-        secure = key.startswith(('__Secure-', '__Host-'))\n+        secure = secure or key.startswith(('__Secure-', '__Host-'))\n         self.set_cookie(\n             key, max_age=0, path=path, domain=domain, secure=secure,\n-            expires='Thu, 01 Jan 1970 00:00:00 GMT',\n+            expires='Thu, 01 Jan 1970 00:00:00 GMT', samesite=samesite,\n+            httponly=httponly,\n         )\n \n     # Common methods used by subclasses\ndiff --git a/docs/ref/request-response.txt b/docs/ref/request-response.txt\nindex 705da1842a..f853bb4ca6 100644\n--- a/docs/ref/request-response.txt\n+++ b/docs/ref/request-response.txt\n@@ -890,14 +890,14 @@ Methods\n \n         Using ``samesite='None'`` (string) was allowed.\n \n-.. method:: HttpResponse.delete_cookie(key, path='/', domain=None)\n+.. method:: HttpResponse.delete_cookie(key, path='/', domain=None, samesite=None, httponly=False, secure=False)\n \n     Deletes the cookie with the given key. Fails silently if the key doesn't\n     exist.\n \n-    Due to the way cookies work, ``path`` and ``domain`` should be the same\n-    values you used in ``set_cookie()`` -- otherwise the cookie may not be\n-    deleted.\n+    Due to the way cookies work, ``path``, ``domain``, ``samesite``, and\n+    ``secure`` should be the same values you used in ``set_cookie()`` --\n+    otherwise the cookie may not be deleted.\n \n .. method:: HttpResponse.close()\n \n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-02-03T02:02:37.421044",
  "end_time": "2026-02-03T02:18:40.590311",
  "duration_seconds": 963.169267,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "b49c889a-c80e-434e-b2c0-da07c62ffb68",
      "epic_title": "Fix: django__django-13195",
      "comment_id": "6b14fcf2-bc02-41fa-b735-df7e5026db06",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nFixed `HttpResponse.delete_cookie()` to preserve cookie's `samesite` attribute when deleting cookies. This addresses browser warnings about cookies with `SameSite` set to \"none\" or invalid value without the \"secure\" attribute.\n\n## Root Cause\n\nWhen `delete_cookie()` was called, it only set `path` and `domain` parameters, but did not preserve `samesite` or `httponly` attributes that were originally set on the cookie. This caused browsers to show warnings because the deleted cookie appeared to have inconsistent security attributes.\n\n## Files Modified\n\n- **django/http/response.py**: Added `samesite` and `httponly` parameters to `delete_cookie()` method\n- **django/contrib/messages/storage/cookie.py**: Updated to pass `samesite` and `httponly` when deleting the messages cookie\n- **django/contrib/sessions/middleware.py**: Updated to pass `samesite` and `httponly` when deleting the session cookie\n- **docs/ref/request-response.txt**: Updated documentation to reflect new parameters\n\n## Test Results\n\n- **Test file:** tests/responses/test_cookie.py\n- **Baseline (before fix):** 11 passed, 0 failed, 0 errors\n- **After fix:** 11 passed, 0 failed, 0 errors\n- **Additional tests:** tests/messages_tests/test_cookie.py - 28 passed\n- **Regression check:** No new failures introduced\n\n## Verification\n\nThe fix was verified to correctly preserve cookie attributes:\n```python\n# Set cookie with samesite=Lax\n# Delete cookie with samesite=Lax\n# Result: Deleted cookie now has samesite=Lax (preserved)\n```\n\n## Edge Cases Considered\n\n- Backward compatibility: All new parameters are optional with sensible defaults (`samesite=None`, `httponly=False`)\n- Existing code that doesn't use these parameters will continue to work as before\n- The secure flag behavior for `__Host-` and `__Secure-` prefixed cookies is preserved",
      "created_at": "2026-02-03T01:08:44.223Z"
    },
    {
      "epic_id": "b49c889a-c80e-434e-b2c0-da07c62ffb68",
      "epic_title": "Fix: django__django-13195",
      "comment_id": "df2cdca3-6e9d-4b93-9831-2aa7077b4678",
      "author_name": "Code Reviewer",
      "content": "Code Review FAILED\n\nIssues Found:\n- `HttpResponse.delete_cookie()` now accepts `samesite`, and callers (sessions/messages) pass `settings.SESSION_COOKIE_SAMESITE`. If that value is `'None'`, the generated `Set-Cookie` deletion header will include `SameSite=None` but `Secure` remains unset for normal cookie names (only `__Secure-`/`__Host-` get `secure=True`). Modern browsers reject `SameSite=None` cookies without `Secure`, so the cookie may fail to be deleted (regression / does not fully address the report\u2019s concern).\n- Documentation mismatch: code adds `httponly` to `delete_cookie()` but `docs/ref/request-response.txt` only documents `samesite`.\n\nRequired Changes:\n- Ensure `delete_cookie()` produces `Secure` when `samesite` is `'None'` (case-insensitive), and/or add a `secure` parameter and pass the appropriate value from session/message call sites.\n- Update the docs signature/description to match the public API parameters you keep (`samesite`, and `httponly`/`secure` if present).",
      "created_at": "2026-02-03T01:13:48.350Z"
    },
    {
      "epic_id": "b49c889a-c80e-434e-b2c0-da07c62ffb68",
      "epic_title": "Fix: django__django-13195",
      "comment_id": "3c28ee4a-60a4-4e1e-bec2-2ca00a7e4ef9",
      "author_name": "Brainstormer",
      "content": "## Addressed Code Review Feedback\n\nMade the following changes to address the Code Reviewer's concerns:\n\n### 1. Added `secure` parameter to `delete_cookie()`\n- Added `secure=False` as a new parameter to `HttpResponse.delete_cookie()`\n- The logic now uses `secure = secure or key.startswith(('__Secure-', '__Host-'))` so that:\n  - Explicit `secure=True` is honored\n  - `__Secure-` and `__Host-` prefixes still auto-set `secure=True` for backward compatibility\n\n### 2. Updated callers to pass `secure` parameter\n- **django/contrib/messages/storage/cookie.py**: Now passes `secure=settings.SESSION_COOKIE_SECURE or None` when deleting the messages cookie\n- **django/contrib/sessions/middleware.py**: Now passes `secure=settings.SESSION_COOKIE_SECURE or None` when deleting the session cookie\n\nThis ensures that when `SESSION_COOKIE_SECURE=True`, the deleted cookie will have `Secure` set, which is required for `SameSite=None` cookies in modern browsers.\n\n### 3. Updated documentation\n- **docs/ref/request-response.txt**: Updated to document all parameters: `samesite`, `httponly`, and `secure`\n\n### Files Modified (Round 2)\n- **django/http/response.py**: Added `secure` parameter to `delete_cookie()`\n- **django/contrib/messages/storage/cookie.py**: Added `secure` parameter to `delete_cookie()` call\n- **django/contrib/sessions/middleware.py**: Added `secure` parameter to `delete_cookie()` call  \n- **docs/ref/request-response.txt**: Updated to document `secure` parameter\n\n### Test Results\n- **tests.responses.test_cookie**: 11 passed\n- **tests.messages_tests.test_cookie**: 28 passed\n- **Total**: 39 tests passed, 0 failures, 0 errors\n\n### Verification\nThe fix correctly handles:\n- Explicit `secure=True` sets the Secure flag\n- `__Secure-`/`__Host-` prefixes auto-set Secure (backward compatible)\n- `secure=False` (or None) does not set Secure flag\n- All cookie attributes (samesite, httponly, secure) are preserved when deleting cookies",
      "created_at": "2026-02-03T01:17:08.844Z"
    },
    {
      "epic_id": "b49c889a-c80e-434e-b2c0-da07c62ffb68",
      "epic_title": "Fix: django__django-13195",
      "comment_id": "00451286-83ec-467a-91a5-3707b96008e4",
      "author_name": "Code Reviewer",
      "content": "Code review PASSED.\n\n- `HttpResponse.delete_cookie()` now supports `samesite` and callers (sessions/messages) pass through the session cookie settings, so deletion preserves SameSite where applicable.\n- Added `secure` parameter and updated call sites to supply `SESSION_COOKIE_SECURE`, addressing the earlier concern about `SameSite=None` requiring `Secure` in modern browsers.\n\nNotes (non-blocking):\n- Docs mention `secure` but don\u2019t mention `httponly` in the \u201csame values\u201d sentence; optional to clarify.",
      "created_at": "2026-02-03T01:18:33.810Z"
    }
  ]
}