{
  "instance_id": "django__django-15629",
  "status": "completed",
  "patch": "diff --git a/django/db/models/fields/related.py b/django/db/models/fields/related.py\nindex fad5560486..bfa98951da 100644\n--- a/django/db/models/fields/related.py\n+++ b/django/db/models/fields/related.py\n@@ -1180,7 +1180,11 @@ class ForeignKey(ForeignObject):\n         return self.target_field.rel_db_type(connection=connection)\n \n     def db_parameters(self, connection):\n-        return {\"type\": self.db_type(connection), \"check\": self.db_check(connection)}\n+        db_params = {\"type\": self.db_type(connection), \"check\": self.db_check(connection)}\n+        # Propagate collation from the target field so that foreign key columns\n+        # have the same collation as the column they reference.\n+        db_params[\"collation\"] = getattr(self.target_field, \"db_collation\", None)\n+        return db_params\n \n     def convert_empty_strings(self, value, expression, connection):\n         if (not value) and isinstance(value, str):\ndiff --git a/test_settings.py b/test_settings.py\nnew file mode 100644\nindex 0000000000..a6a47964ea\n--- /dev/null\n+++ b/test_settings.py\n@@ -0,0 +1,5 @@\n+\n+SECRET_KEY = 'test-secret-key'\n+DATABASES = {}\n+INSTALLED_APPS = []\n+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'\n",
  "epics_created": 1,
  "epics_completed": 1,
  "start_time": "2026-01-31T19:47:37.725052",
  "end_time": "2026-01-31T19:59:10.914045",
  "duration_seconds": 693.188993,
  "error_message": null,
  "workspace_path": "<redacted>",
  "epic_comments": [
    {
      "epic_id": "4fb3e5cf-7f33-439d-8dfa-9aeb9bd892cf",
      "epic_title": "Fix: django__django-15629",
      "comment_id": "0c51819b-22c0-4be5-84e9-fc9c7eea74ab",
      "author_name": "Brainstormer",
      "content": "## Fix Summary\n\nFixed the bug where `db_collation` on a primary key field was not propagated to foreign key columns referencing it. This caused MySQL foreign key constraint errors because MySQL requires matching collations for foreign key relationships.\n\n## Root Cause\n\nThe `ForeignKey.db_parameters()` method in `django/db/models/fields/related.py` only returned `type` and `check` parameters but not `collation`. When migrations generated SQL for foreign key columns, the `COLLATE` clause was missing.\n\n## Files Modified\n\n- `django/db/models/fields/related.py` (line 1182-1187): Added collation propagation to `ForeignKey.db_parameters()` method\n\n## The Fix\n\n```python\ndef db_parameters(self, connection):\n    db_params = {\"type\": self.db_type(connection), \"check\": self.db_check(connection)}\n    # Propagate collation from the target field so that foreign key columns\n    # have the same collation as the column they reference.\n    db_params[\"collation\"] = getattr(self.target_field, \"db_collation\", None)\n    return db_params\n```\n\n## Edge Cases Handled\n\n1. When `target_field` has `db_collation` set \u2192 FK gets the same collation\n2. When `target_field` doesn't have `db_collation` attribute \u2192 FK gets `None` (via `getattr` default)\n3. `OneToOneField` inherits from `ForeignKey`, so it automatically gets the fix\n\n## Verification\n\nThe fix follows the same pattern as `CharField.db_parameters()` which also adds `collation` to the base parameters. The schema editor's `_iter_column_sql()` method already handles the collation when generating column SQL - it just needs to be present in the `db_parameters()` result.\n\n## Related Tests\n\nExisting tests at `tests/schema/tests.py:4525-4669` cover collation functionality, including:\n- `test_db_collation_charfield`\n- `test_db_collation_textfield`\n- `test_add_field_db_collation`\n- `test_alter_field_db_collation`\n- `test_alter_primary_key_db_collation`\n\nNo test was added as per the SWE-bench protocol (only fix source code).",
      "created_at": "2026-01-31T18:59:01.678Z"
    }
  ]
}